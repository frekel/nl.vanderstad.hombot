<html>
<head>
    <script type="text/javascript">

      Homey.emit('get_pairing_error', {})
        .then(function (pairingError) {
          $('#pairing-error').html(pairingError);
        });


      function submit() {
        Homey.showLoadingOverlay();
        console.log('Saving settings...');
        let address = $('#address').val();
        let port = $('#port').val();

        if (address !== '') {
          // Build data array
          let data = {
            address: address,
            port: port
          };

          console.log('Saving device data', data);

          // Continue to back-end, pass along data
          Homey.emit('set_manual_device', data);

        } else {
          $('#homebot-error').html("&#10060; Invalid fields").show();
          Homey.hideLoadingOverlay();
        }
      }

    </script>

    <style>
        .form-group {
            width: 100%;
            display: block;
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
        }

        .form-group input {
            width: 100%;
            display: block;
            margin-bottom: 12px;
        }

        .textbox {
            border-style: hidden hidden solid hidden;
        }

        .button {
            display: block;
            width: 100%;
        }

        .button:enabled {
            background-color: #00c139 !important;
            color: #fff;
        }

        .roundrect {
            color: #716705;
            border: 1px;
            border-color: #877b0b;
            border-style: solid;
            border-radius: 4px;
            background-color: khaki;
            width: auto;
            height: auto;
            padding: 3px 4px 3px 4px;
        }
    </style>
</head>

<body>
    <p class="roundrect"><font size="+1">&#129300;</font> <span id='pairing-error'></span>.</p>
    <p>
        <span data-i18n="pair.try_manual_pairing">You can continue with the manual pairing.</span><br/>
        <span data-i18n="pair.intro">Enter the details of your vacuum.</span>
    </p>
    <form class="form-group" onsubmit="submit()">
        <label for="address" data-i18n="pair.address">IP address</label>
        <input type="text" class="textbox" id="address" pattern="\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b" inputmode="numeric" required>
        <label for="port"><span data-i18n="pair.port">Port</span> (<span data-i18n="pair.default_value">default value</span>: 6260)</label>
        <input type="text" class="textbox" id="port" pattern="\b\d{1,5}\b" inputmode="numeric" value="6260" required>
        <button type="submit" class="button" data-i18n="pair.connect">Connect</button>
    </form>
    <p id="homebot-error" style="color: #ff3300;" hidden></p>
</body>
</html>
